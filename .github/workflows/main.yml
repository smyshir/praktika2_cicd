name: CI/CD Pipeline

on:
  push:
    branches: [ main, development, release ]
    tags:
      - 'v*'   # —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ç–µ–≥–∏ —Ä–µ–ª–∏–∑–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä v1.0
  pull_request:
    branches: [ main ]

jobs:
  # --- CI: —Å–±–æ—Ä–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ---
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest pdoc

      - name: Run tests
        run: pytest -v

      - name: Generate documentation
        run: |
          mkdir -p docs
          pdoc . -o docs
          echo "üìò Documentation generated successfully."

      - name: Upload documentation artifact
        uses: actions/upload-artifact@v4
        with:
          name: documentation
          path: docs/

  # --- CD: –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ ---
  deploy:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/release' || startsWith(github.ref, 'refs/tags/v')
    steps:
      - name: Simulate deployment
        run: |
          echo "‚úÖ Tests passed successfully."
          echo "üöÄ Deploying application to staging server..."
          echo "--------------------------------------------"
          echo "Branch or tag: $GITHUB_REF"
          echo "Deployed version ready!"
